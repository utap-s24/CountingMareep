
# Counting Mareep

Counting Mareep is a supplementary app for Pokémon Sleep, a mobile game that enables quicker access to your Pokémon. It allows users to effectively manage and evaluate their teams without the lengthy wait times associated with the official app.
## Authors

- [@EmperorBob7](https://github.com/EmperorBob7/)
- [@UTHasandhu](https://github.com/UTHasandhu)
## Building and Running
--------------------

### Back End

-   If you want to run our back end server, you just cd into the server directory and then run npm install to install all of our packages (Node.JS and NPM are required for this). Then to run the server just do node . and the server will be running. As it is, the Android App uses our server from Render so you will need to swap the following lines in MainActivity.kt.

```js
val BASE_URL = "http://192.168.1.244:3030/"

val BASE_URL = "<https://countingmareep.onrender.com/>"
```

### Android App

-   This is easy enough to build, just load the project in Android Studio and build/run it as you would any other project. We used the same settings recommended for the other Homeworks/Projects so there shouldn't be any issues there.

### API Documentation
-----------------

The documentation can be found on Postman here:

<https://documenter.getpostman.com/view/32889204/2sA3Bt3q8U>

The API is public and has CORS enabled so anyone can use it if they wanted to, but it's secure enough that essential data like passwords can't be leaked out of it.
## UI/UX Highlights

Our app features an innovative search bar that allows users to view other users' teams and a well-designed Pokémon box UI that simplifies adding Pokémon to your collection. We also wrote Theme toggling which unfortunately doesn’t work as well as hoped since the App has to restart to apply the changes with the way we wrote it, but it works well and it’s done using the SharedPreferences feature of Android which works very similarly to LocalStorage in a Browser.

We also wrote custom theme styles for our theme toggling, though it’s nothing crazy since our theme is kept to very few colors. However one challenge we had with this was the theme generated by the Android Project by default for Bottom Navigation Apps was problematic since it didn’t properly support actual Light/Dark themes and potentially even more themes if we wanted in the future so we had to rewrite some of the names and parents of our styles.

## Back End
Implementing multi-user support and session management was challenging but educational, especially in managing various user interactions securely and efficiently.

We wrote signing up and logging in manually using Mongoose as mentioned earlier and the API endpoints themselves using Express which did take time to do but gave us more direct control not only over our sessions, but over the database since we were writing an intermediate layer between the Android App and the Database which is something you can’t do if you’re using Firebase directly.

## Learning Outcomes
While doing this project we learned how difficult it can be to do tasks that tend to be easy for other languages or platforms due to either better structure or less security. For example, making API requests is such a hassle in Kotlin/Java while in languages like JavaScript and Python they’re very core features that are easy to use with solid abstractions.

However, when doing this App we also learned how to manage state at a more complex level in Android and how to modularize different components of an application, in this case the Database, the Server, and the Android App. If we wanted to add another component to this setup we could add a website as well since we have all the necessary components already to integrate with it.

However, the most important thing we probably learned was how expensive Images and HTTP requests are for performance on a phone. On laptops and desktops we don’t notice as much since they’re everywhere, but the systems tend to be much stronger as well. However on a phone you’re dealing with much more limited Hardware resources and heating problems so you have to ensure that you load only what you need and optimize anything you can to avoid lagging a device.

## Challenges and Debugging
One of the most difficult challenges we overcame was theme toggling. This was actually something we handled very early on, before we even implemented any other logic at all, and this was actually a very good call. As mentioned before the default project setup was problematic and didn’t define the styles correctly for themes so some refactoring was needed to fix that.

After that we wrote a simple Theme toggle in Kotlin and found out when theme toggling the App needed to restart every time you toggled themes. Initially we got around this by storing the current navigation location in the SharedPreferences, which was fine at the time since there wasn’t logging in or anything, but it became an issue once we implemented authentication since restarting the app meant the session of the device was cleared.

There were 2 ways to solve this and we decided to take a safer approach of just making the user restart the app if they want to see the theme change. The alternative solution was storing the session UUID inside the SharedPreferences as well, but this felt very prone to error since it could possibly skip some important ViewModel initialization needed on starting the App so we decided to avoid the trouble.


## Features and Libraries

-   **Custom API and Database:** Our app uses a custom API built using the Express.js framework to create a web server and HTTP endpoints. This server also connects to MongoDB Atlas to store/update the data for users, Pokémon, and teams.

    -   More details about the API will be in the API section of this document.

-   **Server Hosting:** Since we made our own server, we also needed to host it somewhere. Since this is a currently small-scale server, we decided to use Render's free tier for hosting and a Ping client to ensure the server stayed awake. The API is publicly accessible here with basic documentation for the endpoints on the URL and arguments here: <https://documenter.getpostman.com/view/32889204/2sA3Bt3q8U>

-   **Android Features:** Utilization of a bottom navigation bar for seamless navigation between the main views: box page, search teams page, build team page, and settings page.

- ### Third-Party Libraries (Android):

    -   **Retrofit:** We used Retrofit as our HTTP client in the app to make the calls to our custom server. We created a Call for each endpoint listed on our Postman Documentation above and created a few custom Data Classes to load the data responses from the endpoints.

        -   Retrofit made HTTP requests relatively simple for Kotlin which was a great benefit when we were short on time. It was very easy to create new calls after we set up the first one and we found out how instead of defining fields for requests you can also just define bodies using @Body which was really useful for endpoints that needed Arrays as arguments.

        -   One problem with Retrofit is that it can easily make your code much larger than it probably needs to be, but this isn't necessarily an issue with Retrofit since it allows you to handle errors with requests and other issues that may occur that we thankfully didn't really have to deal with since we wrote our API in a way that it was easy to handle errors.

    -   **OkHttp:** Manages efficient HTTP communication for network operations. We used this library for making sure our HTTP requests were successful which helped avoid errors with Null Pointers or trying to read data that isn't there. It was easy to use since it was well integrated into Retrofit and there aren't really any issues that we had with it since it was mostly abstracted away.

-  ### Third-Party Libraries (JS):

    -   **Bcrypt:** Bcrypt was used to hash and salt the passwords for users since we wrote Authentication ourselves. It was also used to check if a password matched the hashed+salted version we store in our Database because salting makes it so hashing the same password doesn't necessarily give you the same result.

        -   It was very easy to use since it's well abstracted and the documentation for the API is easy to understand. We've also used it before for personal projects so that was a benefit. There are no problems we had with this library.

    -   **Cors:** Cors is a middleware library that can be used with Express.JS. This library makes it so you can send HTTP requests to this server across different origins which is necessary for our Android App since it's going to be on a different origin by nature. It was very easy to use since express handles middleware very beautifully (a 1 liner!) and no downsides for this library since we had no issues with using it.

    -   **Dotenv:** This library was used to store Environment Variables since you generally don't want to push those to your repository since they're supposed to be secret. However, since you (the professor) requested we keep keys inside our project we initially pushed our .env file, and later removed it from commits though you can still access it on our GitHub repository.

        -   No issues with this library as it is a staple for JS development and always works perfectly.

    -   **Email-validator:** This was a single purpose library that we used to ensure that emails were valid. We didn't do anything with these emails other than storing them in our Database for the User instance, but they could be useful for verifying a User in the future by sending them an email.

        -   This library was easy to use again by having well-abstracted static methods we could use and seemed to work well based on our simple tests for it.

    -   **Express:** The real meat of the JS side was Express. It is our goto library for creating HTTP servers since it supports lots of middleware as mentioned before, and makes it easy to create API endpoints and also lets you have asynchronous responses which is necessary when using a Database.

        -   As always this library is extremely easy to use and lets you define a lot of finer details like request limit sizes to avoid filling up our database and was easy to get working when hosting on Render.

    -   **Mongoose:** Mongoose is the most popular library for using MongoDB in Node.JS. It's easy to connect to the database using the connection URL and password stored in our .env file. After connecting, you can create Schema which defines how an entry in a Table of the database is stored which was easy to set up since we already defined most of the data in our Kotlin app when we were ensuring core functionality works without connecting to the server.

        -   Great experience using it because we already used it before, but one problem with it is that it has a few arbitrary quirks that you must know about when using it. For example if you have a Schema called "User" it will create the table in the Database as "users".

    -   **Uuid:** UUID was used to generate UUIDs for our sessions. Sessions were used to let a user login once and then make HTTP requests after that without having to make a MongoDB request or pass along the username and password for every request which would be extremely unsafe. This library seemed to work well and generated unique UUIDs as far as we could tell, so no issues with it.

-   ### Third-Party Services:

    -   **Postman:** Postman was used to document the API that we wrote in Express.js and test our API directly from VS Code using the extension. Postman is very easy to use since it connects to your actual account from VS Code which saves a lot of memory compared to other API testers like "Insomnia".

    - **Render:** Render was used to host our Express server 24/7 for free. It doesn't have amazing performance but it works well enough to handle requests quickly enough to not feel too laggy on Android and it being 24/7 helps since it doesn't have to spindle down or up which other hosts tend to do on their free-tier now.
### Screenshots/Images

![](https://cdn.discordapp.com/attachments/571784589882949692/1244764012344774728/image.png?ex=66564c53&is=6654fad3&hm=249907cc84346536e7a01288879d56489b648cdeb6ba98601a5e4c745dbeb574&)
![](https://cdn.discordapp.com/attachments/571784589882949692/1244764347268468796/image.png?ex=66564ca2&is=6654fb22&hm=c0ab922e5e9cf531dacce7a876a70f5a8d78bdc076eece4b7118a18569686d96&)
![](https://cdn.discordapp.com/attachments/571784589882949692/1244764439891279935/image.png?ex=66564cb9&is=6654fb39&hm=5dd190cb5e8607efb9b9e798618e986796b08c116ed6f65d422f034763344da5&)
![](https://cdn.discordapp.com/attachments/571784589882949692/1244764530681315448/image.png?ex=66564cce&is=6654fb4e&hm=a8a669518b54b08f3465d244d7707817b3c200bb7db0d25f622e247da7b798e4&)
![](https://cdn.discordapp.com/attachments/571784589882949692/1244764644174987294/image.png?ex=66564ce9&is=6654fb69&hm=790610715785cf48d5e9da0c1913e00e7b6798231918012c8fe022206ba3842a&)
